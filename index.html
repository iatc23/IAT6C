<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TafsirHub | IAT C 2023</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;family=Quicksand:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            background: linear-gradient(135deg, #f5ede1 0%, #d4c5a0 50%, #a8905d 100%);
            min-height: 100vh;
        }
        
        html, body, #app {
            height: 100%;
        }

        .islamic-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .page-content {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        button, select, input, textarea {
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(95, 122, 95, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(95, 122, 95, 0.8);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
 </head>
 <body class="h-full"><!-- Header -->
  <header class="bg-white/95 backdrop-blur-md shadow-2xl border-b-4 border-amber-700 sticky top-0 z-50">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-5"><!-- Logo & Title -->
     <div class="flex items-center space-x-4">
      <div class="w-14 h-14 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow"><i class="fas fa-book-open text-white text-2xl"></i>
      </div>
      <div>
       <h1 class="text-3xl font-bold text-amber-900 font-quicksand">TafsirHub</h1>
       <p class="text-sm text-amber-800 font-medium">IAT C 2023 â€¢ UIN Sultan Maulana Hasanuddin</p>
      </div>
     </div><!-- Real-time Clock & User Info -->
     <div class="flex items-center space-x-6">
      <div class="text-right hidden sm:block">
       <div id="current-time" class="text-lg font-bold text-amber-900 font-quicksand"></div>
       <div id="current-date" class="text-xs text-amber-800"></div>
      </div>
      <div class="flex space-x-2"><button onclick="showAdminPanel()" id="admin-panel-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-crown mr-1"></i>Admin </button> <button onclick="handleLogout()" id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-sign-out-alt mr-1"></i>Logout </button>
      </div>
     </div>
    </div>
   </div>
  </header><!-- Navigation -->
  <nav class="bg-gradient-to-r from-amber-700 to-amber-900 shadow-lg">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex space-x-8 overflow-x-auto py-4"><button onclick="showPage('home')" class="nav-btn text-white hover:text-amber-100 px-3 py-2 rounded-md text-sm font-semibold whitespace-nowrap transition-all hover:bg-white/10"> <i class="fas fa-home mr-2"></i>Beranda </button> <button onclick="showPage('tugas')" class="nav-btn text-white hover:text-amber-100 px-3 py-2 rounded-md text-sm font-semibold whitespace-nowrap transition-all hover:bg-white/10"> <i class="fas fa-tasks mr-2"></i>Tugas </button> <button onclick="showPage('semester6')" class="nav-btn text-white hover:text-amber-100 px-3 py-2 rounded-md text-sm font-semibold whitespace-nowrap transition-all hover:bg-white/10"> <i class="fas fa-calendar-alt mr-2"></i>Semester 6 </button> <button onclick="showPage('anggota')" class="nav-btn text-white hover:text-amber-100 px-3 py-2 rounded-md text-sm font-semibold whitespace-nowrap transition-all hover:bg-white/10"> <i class="fas fa-users mr-2"></i>Anggota </button> <button onclick="showLoginModal()" class="nav-btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-semibold whitespace-nowrap transition-all shadow-md"> <i class="fas fa-sign-in-alt mr-2"></i>Login </button>
    </div>
   </div>
  </nav><!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Home Page -->
   <div id="home-page" class="page-content">
    <div class="text-center mb-12">
     <div class="w-28 h-28 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl transform hover:scale-105 transition-transform"><i class="fas fa-mosque text-white text-5xl"></i>
     </div>
     <h2 class="text-5xl font-bold text-amber-900 mb-4 font-quicksand drop-shadow-lg">Selamat Datang di TafsirHub</h2>
     <p class="text-xl text-amber-800 max-w-3xl mx-auto drop-shadow font-semibold">Platform pembelajaran digital untuk mahasiswa Ilmu Al-Qur'an dan Tafsir Kelas C Angkatan 2023</p>
    </div><!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
     <div class="bg-white/95 rounded-2xl shadow-xl p-8 text-center border-4 border-amber-700 hover:shadow-2xl transition-shadow">
      <div class="w-16 h-16 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg"><i class="fas fa-users text-white text-2xl"></i>
      </div>
      <h3 class="text-4xl font-bold text-amber-900" id="total-members">27</h3>
      <p class="text-amber-800 font-semibold">Total Anggota</p>
     </div>
     <div class="bg-white/95 rounded-2xl shadow-xl p-8 text-center border-4 border-blue-600 hover:shadow-2xl transition-shadow">
      <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg"><i class="fas fa-tasks text-white text-2xl"></i>
      </div>
      <h3 class="text-4xl font-bold text-blue-700" id="total-tasks">0</h3>
      <p class="text-blue-600 font-semibold">Total Tugas</p>
     </div>
    </div><!-- Jadwal Mata Kuliah Semester 6 -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-8 mb-8 border-4 border-amber-600">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-3xl font-bold text-amber-900 font-quicksand flex items-center"><i class="fas fa-calendar-alt text-blue-600 mr-3 text-2xl"></i> Jadwal Mata Kuliah Semester 6</h3><button onclick="showScheduleTableModal()" id="edit-schedule-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-edit mr-2"></i>Edit Jadwal </button>
     </div>
     <div class="overflow-x-auto">
      <table id="schedule-table" class="w-full border-collapse">
       <thead>
        <tr class="bg-amber-100 border-b-4 border-amber-700">
         <th class="px-4 py-4 text-left font-bold text-amber-900">Hari</th>
         <th class="px-4 py-4 text-left font-bold text-amber-900">Waktu</th>
         <th class="px-4 py-4 text-left font-bold text-amber-900">Mata Kuliah</th>
         <th class="px-4 py-4 text-left font-bold text-amber-900">Penanggung Jawab</th>
        </tr>
       </thead>
       <tbody id="schedule-table-body" class="divide-y-2 divide-amber-200">
       </tbody>
      </table>
      <div class="text-center py-8 text-amber-700 font-semibold">
       <p><i class="fas fa-calendar-times mr-2 text-2xl"></i>Belum ada jadwal. Admin akan mengisi segera.</p>
      </div>
     </div>
    </div><!-- Latest Announcements -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-8 mb-8 border-4 border-blue-600">
     <h3 class="text-3xl font-bold text-amber-900 mb-6 font-quicksand flex items-center"><i class="fas fa-bullhorn text-blue-600 mr-3 text-2xl"></i> Pengumuman Terbaru</h3>
     <div id="latest-announcements" class="space-y-4">
      <p class="text-amber-200 text-center py-4 font-semibold">Belum ada pengumuman</p>
     </div>
    </div>
   </div><!-- Semester Pages -->
   <div id="semester6-page" class="page-content hidden">
    <div class="mb-8">
     <h2 class="text-4xl font-bold text-amber-900 mb-4 font-quicksand drop-shadow-lg">Semester 6 (Semester Saat Ini)</h2>
     <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 w-32 rounded-full shadow-lg"></div>
    </div><!-- Daftar Kelompok & Materi Semester 6 -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-amber-600 mb-8">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold text-amber-900 flex items-center"><i class="fas fa-users text-blue-600 mr-3 text-xl"></i>Daftar Kelompok &amp; Materi</h3><button onclick="showGroupMaterialModal()" id="edit-group-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-edit mr-2"></i>Edit Kelompok </button>
     </div>
     <div class="space-y-6" id="group-materials-container">
      <p class="text-amber-700 text-center py-4 font-semibold">Belum ada kelompok. Admin akan mengisi segera.</p>
     </div>
    </div><!-- Jadwal MK Semester 6 -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-amber-600 mb-8">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold text-amber-900 flex items-center"><i class="fas fa-calendar-alt text-blue-600 mr-3 text-xl"></i>Jadwal Mata Kuliah</h3><button onclick="showScheduleTableModal()" id="edit-sem-schedule-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-edit mr-2"></i>Edit Jadwal </button>
     </div>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse">
       <thead>
        <tr class="bg-amber-100 border-b-4 border-amber-700">
         <th class="px-4 py-3 text-left font-bold text-amber-900">Hari</th>
         <th class="px-4 py-3 text-left font-bold text-amber-900">Waktu</th>
         <th class="px-4 py-3 text-left font-bold text-amber-900">Mata Kuliah</th>
         <th class="px-4 py-3 text-left font-bold text-amber-900">Penanggung Jawab</th>
        </tr>
       </thead>
       <tbody id="semester6-schedule-tbody" class="divide-y-2 divide-amber-200">
       </tbody>
      </table>
     </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Tugas -->
     <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-blue-600">
      <h3 class="text-2xl font-bold text-amber-900 mb-4 flex items-center"><i class="fas fa-tasks text-blue-600 mr-3 text-xl"></i>Daftar Tugas</h3>
      <div id="semester6-tasks" class="space-y-3">
      </div><button onclick="showTaskModal('semester6')" id="add-task-btn" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-semibold shadow-md" style="display:none;"> <i class="fas fa-plus mr-2"></i>Tambah Tugas </button>
     </div><!-- RPS -->
     <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-green-600">
      <h3 class="text-2xl font-bold text-amber-900 mb-4 flex items-center"><i class="fas fa-file-alt text-green-600 mr-3 text-xl"></i>RPS &amp; Materi</h3>
      <div class="text-center py-8">
       <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fab fa-google-drive text-green-600 text-3xl"></i>
       </div>
       <h4 class="text-lg font-semibold text-amber-900 mb-2">Google Drive Kelas</h4>
       <p class="text-amber-700 mb-4 font-semibold">Akses semua RPS dan materi pembelajaran</p><a href="https://drive.google.com/drive/folders/1xMHCvGbRA86EMmNfjW8ovtsOqsrfX8aP" target="_blank" rel="noopener noreferrer" class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors font-semibold shadow-md"> <i class="fab fa-google-drive mr-2"></i> Buka Google Drive <i class="fas fa-external-link-alt ml-2 text-sm"></i> </a>
      </div>
     </div>
    </div><!-- Pengumuman Semester -->
    <div class="mt-8 bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-blue-600">
     <h3 class="text-2xl font-bold text-amber-900 mb-4 flex items-center"><i class="fas fa-bullhorn text-blue-600 mr-3 text-xl"></i>Pengumuman Semester 6</h3>
     <div id="semester6-announcements" class="space-y-4">
     </div><button onclick="showAnnouncementModal('semester6')" id="add-announce-btn" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-semibold shadow-md" style="display:none;"> <i class="fas fa-plus mr-2"></i>Tambah Pengumuman </button>
    </div>
   </div><!-- Anggota Page -->
   <div id="anggota-page" class="page-content hidden">
    <div class="mb-8">
     <h2 class="text-4xl font-bold text-amber-900 mb-4 font-quicksand drop-shadow-lg">Daftar Anggota Kelas</h2>
     <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 w-32 rounded-full shadow-lg"></div>
    </div>
    <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-amber-600 mb-6">
     <div class="flex justify-between items-center mb-4">
      <h3 class="text-2xl font-bold text-amber-900">Mahasiswa IAT C 2023</h3>
      <div class="text-sm text-amber-800 font-semibold bg-amber-100 px-4 py-2 rounded-lg"><i class="fas fa-info-circle mr-1"></i> Total: <span id="total-students-display">27</span> mahasiswa
      </div>
     </div><!-- Daftar Nama Mahasiswa -->
     <div class="mb-6">
      <div class="bg-amber-50 rounded-lg border-4 border-amber-300 overflow-hidden">
       <div class="bg-amber-200 p-4 cursor-pointer hover:bg-amber-300 transition-colors" onclick="toggleStudentDropdown()">
        <div class="flex items-center justify-between">
         <h4 class="text-lg font-semibold text-amber-900 flex items-center"><i class="fas fa-list mr-2 text-blue-600"></i> Daftar Nama Mahasiswa <span class="ml-3 text-sm font-normal text-amber-800">(27 mahasiswa)</span></h4><i class="fas fa-chevron-down text-amber-900 transition-transform duration-200" id="student-dropdown-icon"></i>
        </div>
       </div>
       <div class="hidden p-4 pt-0 bg-white" id="student-names-dropdown">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm" id="student-names-list">
        </div>
       </div>
      </div>
     </div><!-- Detail Mahasiswa -->
     <div>
      <h4 class="text-lg font-semibold text-amber-900 mb-3 flex items-center"><i class="fas fa-id-card mr-2 text-blue-600"></i> Detail Mahasiswa</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="members-list">
      </div>
     </div>
    </div><!-- Kelompok Pribadi Section -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-green-600">
     <div class="flex justify-between items-center mb-4">
      <h3 class="text-2xl font-bold text-amber-900 flex items-center"><i class="fas fa-user-friends text-blue-600 mr-3 text-xl"></i>Kelompok Saya</h3>
     </div>
     <div id="personal-groups" class="space-y-4">
      <p class="text-amber-700 text-center py-4 font-semibold">Login untuk melihat kelompok Anda</p>
     </div>
     <div class="mt-4 p-3 bg-green-100 border-4 border-green-400 rounded-lg">
      <p class="text-sm text-green-900 font-semibold"><i class="fas fa-info-circle mr-2"></i> Kelompok resmi otomatis dibuat dari daftar kelompok &amp; materi oleh admin.</p>
     </div>
    </div>
   </div><!-- Tugas Page -->
   <div id="tugas-page" class="page-content hidden">
    <div class="mb-8">
     <h2 class="text-4xl font-bold text-amber-900 mb-4 font-quicksand drop-shadow-lg">Daftar Tugas</h2>
     <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 w-32 rounded-full shadow-lg"></div>
    </div><!-- Tugas Semester 6 -->
    <div class="bg-white/98 rounded-2xl shadow-2xl p-6 border-4 border-blue-600">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold text-amber-900 flex items-center"><i class="fas fa-tasks text-blue-600 mr-3 text-xl"></i>Tugas Semester 6</h3><button onclick="showTaskModal('semester6')" id="add-task-btn-page" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md" style="display:none;"> <i class="fas fa-plus mr-2"></i>Tambah Tugas </button>
     </div>
     <div id="tugas-page-tasks" class="space-y-3">
     </div>
    </div>
   </div>
  </main><!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 border-4 border-amber-700">
    <div class="text-center mb-6">
     <div class="w-20 h-20 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg"><i class="fas fa-user text-white text-3xl"></i>
     </div>
     <h3 class="text-3xl font-bold text-amber-900 font-quicksand">Login TafsirHub</h3>
     <p class="text-amber-800 font-semibold">Masuk ke akun Anda</p>
    </div>
    <form id="login-form" onsubmit="handleLogin(event)">
     <div class="mb-4"><label for="login-username" class="block text-sm font-bold text-amber-900 mb-2">Username</label> <input type="text" id="login-username" name="username" required class="w-full px-4 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 focus:border-transparent" placeholder="Masukkan username">
      <p class="text-xs text-amber-800 mt-1 font-semibold">Contoh: Ligam, Rohmah, Amir</p>
     </div>
     <div class="mb-6"><label for="login-password" class="block text-sm font-bold text-amber-900 mb-2">Password</label> <input type="password" id="login-password" name="password" required class="w-full px-4 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 focus:border-transparent" placeholder="Masukkan password">
      <p class="text-xs text-amber-800 mt-1 font-semibold">Contoh: 69, 70, 93</p>
     </div>
     <div class="flex space-x-3"><button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md"> <i class="fas fa-sign-in-alt mr-2"></i>Login </button> <button type="button" onclick="closeLoginModal()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md"> Batal </button>
     </div>
    </form>
   </div>
  </div><!-- Group Material Edit Modal -->
  <div id="group-material-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-6xl w-full my-8 border-4 border-amber-700">
    <h3 class="text-2xl font-bold text-amber-900 mb-6">Edit Daftar Kelompok &amp; Materi</h3>
    <div class="mb-4"><button onclick="addGroupMaterialRow()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md"> <i class="fas fa-plus mr-2"></i>Tambah Kelompok </button>
    </div>
    <div class="overflow-x-auto mb-6 border-2 border-amber-400 rounded-lg">
     <table id="edit-group-material-table" class="w-full">
      <thead>
       <tr class="bg-amber-200 border-b-4 border-amber-700">
        <th class="px-4 py-3 text-left font-bold text-amber-900">Mata Kuliah</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">No.</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Anggota</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Materi</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Status</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Aksi</th>
       </tr>
      </thead>
      <tbody id="edit-group-material-tbody" class="divide-y-2 divide-amber-200">
      </tbody>
     </table>
    </div>
    <div class="flex space-x-3"><button onclick="saveGroupMaterialTable()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Simpan Perubahan</button> <button onclick="closeGroupMaterialModal()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Batal</button>
    </div>
   </div>
  </div><!-- Schedule Table Edit Modal -->
  <div id="schedule-table-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-6xl w-full my-8 border-4 border-amber-700">
    <h3 class="text-2xl font-bold text-amber-900 mb-6">Edit Jadwal Mata Kuliah</h3>
    <div class="mb-4"><button onclick="addScheduleRow()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-semibold shadow-md"> <i class="fas fa-plus mr-2"></i>Tambah Jadwal </button>
    </div>
    <div class="overflow-x-auto mb-6 border-2 border-amber-400 rounded-lg">
     <table id="edit-schedule-table" class="w-full">
      <thead>
       <tr class="bg-amber-200 border-b-4 border-amber-700">
        <th class="px-4 py-3 text-left font-bold text-amber-900">Hari</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Waktu (Ketik: jam brp - jam brp)</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Mata Kuliah</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Penanggung Jawab (Max 2)</th>
        <th class="px-4 py-3 text-left font-bold text-amber-900">Aksi</th>
       </tr>
      </thead>
      <tbody id="edit-schedule-tbody" class="divide-y-2 divide-amber-200">
      </tbody>
     </table>
    </div>
    <div class="flex space-x-3"><button onclick="saveScheduleTable()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Simpan Perubahan</button> <button onclick="closeScheduleTableModal()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Batal</button>
    </div>
   </div>
  </div><!-- Task Modal -->
  <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 border-4 border-blue-600">
    <h3 class="text-2xl font-bold text-amber-900 mb-4">Tambah Tugas Baru</h3>
    <form id="task-form" onsubmit="handleAddTask(event)">
     <div class="mb-4"><label for="task-title" class="block text-sm font-bold text-amber-900 mb-2">Judul Tugas</label> <input type="text" id="task-title" required class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600">
     </div>
     <div class="mb-4"><label for="task-description" class="block text-sm font-bold text-amber-900 mb-2">Deskripsi</label> <textarea id="task-description" rows="3" class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600"></textarea>
     </div>
     <div class="mb-4"><label for="task-deadline" class="block text-sm font-bold text-amber-900 mb-2">Deadline</label> <input type="datetime-local" id="task-deadline" required class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600">
     </div>
     <div class="mb-6"><label for="task-submission-link" class="block text-sm font-bold text-amber-900 mb-2">Link Pengumpulan (Opsional)</label> <input type="url" id="task-submission-link" class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600" placeholder="https://classroom.google.com/...">
     </div>
     <div class="flex space-x-3"><button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Tambah</button> <button type="button" onclick="closeTaskModal()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Batal</button>
     </div>
    </form>
   </div>
  </div><!-- Announcement Modal -->
  <div id="announcement-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 border-4 border-blue-600">
    <h3 class="text-2xl font-bold text-amber-900 mb-4">Tambah Pengumuman</h3>
    <form id="announcement-form" onsubmit="handleAddAnnouncement(event)">
     <div class="mb-4"><label for="announcement-title" class="block text-sm font-bold text-amber-900 mb-2">Judul Pengumuman</label> <input type="text" id="announcement-title" required class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600">
     </div>
     <div class="mb-4"><label for="announcement-content" class="block text-sm font-bold text-amber-900 mb-2">Isi Pengumuman</label> <textarea id="announcement-content" rows="4" required class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600"></textarea>
     </div>
     <div class="mb-6"><label for="announcement-type" class="block text-sm font-bold text-amber-900 mb-2">Jenis</label> <select id="announcement-type" class="w-full px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600"> <option value="info">Informasi</option> <option value="important">Penting</option> <option value="urgent">Mendesak</option> </select>
     </div>
     <div class="flex space-x-3"><button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Tambah</button> <button type="button" onclick="closeAnnouncementModal()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Batal</button>
     </div>
    </form>
   </div>
  </div><!-- Admin Panel Modal -->
  <div id="admin-panel-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 border-4 border-yellow-500">
    <h3 class="text-2xl font-bold text-amber-900 mb-2"><i class="fas fa-shield-alt text-yellow-500 mr-2"></i>Kelola Admin</h3>
    <p class="text-sm text-amber-800 mb-6 font-semibold">Hanya Amir (Admin Utama) yang dapat mengubah daftar admin</p>
    <div class="mb-6 max-h-64 overflow-y-auto border-2 border-amber-400 rounded-lg p-4 bg-amber-50">
     <div class="space-y-2" id="admin-list-display">
     </div>
    </div>
    <div class="mb-6"><label class="block text-sm font-bold text-amber-900 mb-2">Tambah Admin Pembantu</label>
     <div class="flex space-x-2"><select id="admin-select" class="flex-1 px-3 py-2 border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 font-semibold"> <option value="">-- Pilih Mahasiswa --</option> </select> <button onclick="addAdminToList()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors font-bold shadow-md"> <i class="fas fa-plus"></i> </button>
     </div>
    </div>
    <div class="flex space-x-3"><button onclick="closeAdminPanel()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg transition-colors font-bold shadow-md">Tutup</button>
    </div>
   </div>
  </div><!-- Footer -->
  <footer class="bg-amber-900 text-white py-8 mt-16 shadow-2xl">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center">
     <div class="flex items-center justify-center space-x-4 mb-4">
      <div class="w-12 h-12 bg-gradient-to-br from-amber-400 to-amber-500 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-mosque text-amber-900 text-xl"></i>
      </div>
      <div>
       <h3 class="text-2xl font-bold font-quicksand">TafsirHub</h3>
       <p class="text-amber-300 text-sm font-semibold">Platform Pembelajaran Digital</p>
      </div>
     </div>
     <p class="text-amber-300 text-sm font-semibold">Â© IAT C 2023 | Ilmu Al-Qur'an dan Tafsir | UIN Sultan Maulana Hasanuddin Banten</p>
    </div>
   </div>
  </footer>
  <script>
        // Global variables
        let currentUser = null;
        let currentSemester = null;
        let isLoggedIn = false;
        let userRole = null;
        let adminList = ['Amir'];
        let groupMaterialsData = [];
        let scheduleData = [];

        // Fixed subject list
        const allSubjects = [
            'Creative Writing',
            'Tafsir Emansipatoris',
            'Kajian Teks Tafsir',
            'Terjemah dan Tashih Al-Qur\'an',
            'Masail Tafsir',
            'Ilmu Gharib Al-Qur\'an',
            'Al-Dakhil Fi Al-Tafsir'
        ];

        // Fixed material list
        const allMaterials = [
            'Pendahuluan Tafsir',
            'Tafsir Surat Al-Fatihah',
            'Tafsir Juz Amma',
            'Tafsir Ayat-Ayat Hukum',
            'Tafsir Ayat-Ayat Akidah',
            'Tafsir Ayat-Ayat Sosial',
            'Metode Tafsir Kontekstual',
            'Perbandingan Tafsir'
        ];

        // Student database - FIXED DATA
        const studentDatabase = [
            { username: 'Ligam', password: '69', nim: '20230069', name: 'Nur\'aini Budiyanto', nickname: 'Ligam', active: true },
            { username: 'Rohmah', password: '70', nim: '20230070', name: 'Siti Rohmah', nickname: 'Rohmah', active: true },
            { username: 'Iyus', password: '71', nim: '20230071', name: 'Yusroh', nickname: 'Iyus', active: true },
            { username: 'Yanti', password: '72', nim: '20230072', name: 'Fazriyanti', nickname: 'Yanti', active: true },
            { username: 'Farrij', password: '75', nim: '20230075', name: 'Muhammad Farrij Hasbullah', nickname: 'Farrij', active: true },
            { username: 'Fina', password: '76', nim: '20230076', name: 'Fina Ramadhani', nickname: 'Fina', active: true },
            { username: 'Zirah', password: '77', nim: '20230077', name: 'Annida Nazirah', nickname: 'Zirah', active: true },
            { username: 'Haris', password: '78', nim: '20230078', name: 'Haris Abdurrahman', nickname: 'Haris', active: true },
            { username: 'Ropik', password: '80', nim: '20230080', name: 'Khoirul Ropik Sidik', nickname: 'Ropik', active: true },
            { username: 'Fadli', password: '81', nim: '20230081', name: 'Muhammad Fadli', nickname: 'Fadli', active: true },
            { username: 'Faqih', password: '84', nim: '20230084', name: 'Ahmad Mumtazul Faqih', nickname: 'Faqih', active: true },
            { username: 'Alif', password: '86', nim: '20230086', name: 'Alif Maulana', nickname: 'Alif', active: true },
            { username: 'Irsyad', password: '90', nim: '20230090', name: 'Muhammad Irsyad Muafa', nickname: 'Irsyad', active: true },
            { username: 'Syafiq', password: '91', nim: '20230091', name: 'Muhammad Syafiq Rinaldi', nickname: 'Syafiq', active: true },
            { username: 'Aang', password: '92', nim: '20230092', name: 'Aang Ahmad Syahid', nickname: 'Aang', active: true },
            { username: 'Amir', password: '93', nim: '20230093', name: 'Amirulloh', nickname: 'Amir', active: true },
            { username: 'Mudi', password: '94', nim: '20230094', name: 'Ahmad Turmudi', nickname: 'Mudi', active: true },
            { username: 'Fafa', password: '95', nim: '20230095', name: 'Humrotus Safataeni', nickname: 'Fafa', active: true },
            { username: 'Syafa', password: '96', nim: '20230096', name: 'Ahmad Musyafa Ardha', nickname: 'Syafa', active: true },
            { username: 'Hani', password: '97', nim: '20230097', name: 'Hanifatul Azizah', nickname: 'Hani', active: true },
            { username: 'Rama', password: '98', nim: '20230098', name: 'Syahru Ramadhanil Anam', nickname: 'Rama', active: true },
            { username: 'Nadia', password: '99', nim: '20230099', name: 'Nadia Nur Padilah', nickname: 'Nadia', active: true },
            { username: 'Rizki', password: '100', nim: '20230100', name: 'M Rizki Kurniawan', nickname: 'Rizki', active: true },
            { username: 'Sifa', password: '101', nim: '20230101', name: 'Sifa Fauziah', nickname: 'Sifa', active: true },
            { username: 'Biah', password: '102', nim: '20230102', name: 'Siti Robiah', nickname: 'Biah', active: true },
            { username: 'Isma', password: '103', nim: '20230103', name: 'Ismatul Latifah', nickname: 'Isma', active: true },
            { username: 'Akmal', password: '104', nim: '20230104', name: 'Akmal Muhammad Widad F', nickname: 'Akmal', active: true }
        ];

        // Persistent data structure
        let persistentData = {
            global: {
                tasks: { semester6: [] },
                schedules: { semester6: [] },
                rps: { semester6: [] },
                announcements: { semester6: [] },
                photos: [],
                personalGroups: {},
                groupMaterials: [],
                scheduleData: [],
                adminList: ['Amir']
            },
            users: {}
        };

        // Initialize data storage
        function initializeDataStorage() {
            const savedData = localStorage.getItem('tafsirHubGlobalData');
            
            if (savedData) {
                try {
                    const loadedData = JSON.parse(savedData);
                    persistentData = loadedData;
                    adminList = persistentData.global.adminList || ['Amir'];
                    groupMaterialsData = persistentData.global.groupMaterials || [];
                    scheduleData = persistentData.global.scheduleData || [];
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            } else {
                for (let i = 1; i <= 8; i++) {
                    const semesterKey = `semester${i}`;
                    persistentData.global.tasks[semesterKey] = [];
                    persistentData.global.schedules[semesterKey] = [];
                    persistentData.global.rps[semesterKey] = [];
                    persistentData.global.announcements[semesterKey] = [];
                }
                
                studentDatabase.forEach(student => {
                    persistentData.users[student.username] = { personalGroups: [] };
                });
            }
            
            saveDataToStorage();
        }

        // Save data to localStorage
        function saveDataToStorage() {
            try {
                persistentData.global.groupMaterials = groupMaterialsData;
                persistentData.global.scheduleData = scheduleData;
                persistentData.global.adminList = adminList;
                persistentData.global.lastUpdated = new Date().toISOString();
                persistentData.global.lastUpdatedBy = currentUser ? currentUser.name : 'System';
                
                localStorage.setItem('tafsirHubGlobalData', JSON.stringify(persistentData));
                triggerDataRefresh();
            } catch (e) {
                console.error('Error saving data:', e);
                showErrorMessage('Gagal menyimpan data!');
            }
        }

        // Trigger data refresh
        function triggerDataRefresh() {
            localStorage.setItem('tafsirHubDataChanged', Date.now().toString());
        }

        // Setup data change listener
        function setupDataChangeListener() {
            window.addEventListener('storage', function(e) {
                if (e.key === 'tafsirHubDataChanged' || e.key === 'tafsirHubGlobalData') {
                    reloadDataFromStorage();
                }
            });
            
            setInterval(function() {
                const savedData = localStorage.getItem('tafsirHubGlobalData');
                if (savedData) {
                    try {
                        const loadedData = JSON.parse(savedData);
                        const currentTimestamp = persistentData.global.lastUpdated || '';
                        const newTimestamp = loadedData.global.lastUpdated || '';
                        
                        if (newTimestamp !== currentTimestamp) {
                            reloadDataFromStorage();
                        }
                    } catch (error) {
                        console.error('Error checking for changes:', error);
                    }
                }
            }, 2000);
        }

        // Reload data from storage
        function reloadDataFromStorage() {
            const savedData = localStorage.getItem('tafsirHubGlobalData');
            if (savedData) {
                try {
                    const loadedData = JSON.parse(savedData);
                    const oldTimestamp = persistentData.global.lastUpdated || '';
                    const newTimestamp = loadedData.global.lastUpdated || '';
                    
                    if (newTimestamp !== oldTimestamp) {
                        persistentData = loadedData;
                        adminList = persistentData.global.adminList || ['Amir'];
                        groupMaterialsData = persistentData.global.groupMaterials || [];
                        scheduleData = persistentData.global.scheduleData || [];
                        
                        refreshAllDisplays();
                        
                        if (persistentData.global.lastUpdatedBy && currentUser && 
                            persistentData.global.lastUpdatedBy !== currentUser.name && isLoggedIn) {
                            showSuccessMessage(`ðŸ“± Data diperbarui oleh ${persistentData.global.lastUpdatedBy}`);
                        }
                    }
                } catch (error) {
                    console.error('Error reloading data:', error);
                }
            }
        }

        // Refresh all displays
        function refreshAllDisplays() {
            loadGroupMaterials();
            updateScheduleTables();
            loadTasks('semester6');
            loadAnnouncements('semester6');
            loadLatestAnnouncements();
            if (isLoggedIn) {
                loadPersonalGroups();
            }
            updateAllStats();
        }

        // Real-time clock
        function updateClock() {
            const now = new Date();
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false 
            };
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            document.getElementById('current-time').textContent = now.toLocaleTimeString('id-ID', timeOptions);
            document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', dateOptions);
        }

        setInterval(updateClock, 1000);
        updateClock();

        // Page navigation
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            document.getElementById(pageId + '-page').classList.remove('hidden');
        }

        // Login Modal
        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('login-modal').classList.add('flex');
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('login-modal').classList.remove('flex');
            document.getElementById('login-form').reset();
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = (document.getElementById('login-username').value || '').trim();
            const password = (document.getElementById('login-password').value || '').trim();

            if (!username || !password) {
                showErrorMessage('Username dan Password harus diisi!');
                return;
            }

            const student = studentDatabase.find(s => {
                const usernameMatch = s.username.toLowerCase().trim() === username.toLowerCase().trim();
                const passwordMatch = s.password.toString().trim() === password.toString().trim();
                return usernameMatch && passwordMatch && s.active;
            });

            if (student) {
                const isAdmin = adminList.includes(student.username);
                const role = isAdmin ? 'admin' : 'student';
                
                currentUser = { 
                    username: student.username, 
                    nim: student.nim, 
                    role: role,
                    name: student.name,
                    nickname: student.nickname
                };
                userRole = role;
                isLoggedIn = true;
                
                savePermanentLogin(currentUser);
                loadUserData();
                
                const roleText = role === 'admin' ? 'Admin' : 'Mahasiswa';
                showSuccessMessage(`Selamat datang, ${student.nickname}! Login berhasil sebagai ${roleText}.`);
                closeLoginModal();
                updateUIForLoggedInUser();
            } else {
                showErrorMessage('Login gagal! Username atau Password tidak ditemukan.');
            }
        }

        // Handle Logout
        function handleLogout() {
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4 border-4 border-red-400">
                    <h3 class="text-lg font-bold text-amber-900 mb-4">Konfirmasi Logout</h3>
                    <p class="text-amber-800 mb-6 font-semibold">Apakah Anda yakin ingin logout? Semua perubahan Anda telah disimpan.</p>
                    <div class="flex space-x-3">
                        <button onclick="confirmLogout(true, this)" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-bold transition-colors">Ya, Logout</button>
                        <button onclick="confirmLogout(false, this)" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg font-bold transition-colors">Batal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        function confirmLogout(confirmed, buttonElement) {
            const confirmDiv = buttonElement.closest('.fixed');
            document.body.removeChild(confirmDiv);
            
            if (confirmed) {
                currentUser = null;
                isLoggedIn = false;
                userRole = null;
                
                localStorage.removeItem('tafsirHubPermanentLogin');
                
                showSuccessMessage('Logout berhasil! Sampai jumpa lagi.');
                
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        // Load user data after login
        function loadUserData() {
            loadPersonalGroups();
            loadGroupMaterials();
            updateAllStats();
        }

        // Save permanent login
        function savePermanentLogin(user) {
            try {
                const loginData = {
                    user: user,
                    timestamp: new Date().toISOString(),
                    version: '4.0'
                };
                localStorage.setItem('tafsirHubPermanentLogin', JSON.stringify(loginData));
            } catch (error) {
                console.error('Error saving login:', error);
            }
        }

        // Load permanent login
        function loadPermanentLogin() {
            try {
                const savedLogin = localStorage.getItem('tafsirHubPermanentLogin');
                if (savedLogin) {
                    const loginData = JSON.parse(savedLogin);
                    if (loginData.user && loginData.user.username) {
                        const student = studentDatabase.find(s => 
                            s.username === loginData.user.username && s.active
                        );
                        
                        if (student) {
                            const isAdmin = adminList.includes(student.username);
                            currentUser = { ...loginData.user, role: isAdmin ? 'admin' : 'student' };
                            userRole = currentUser.role;
                            isLoggedIn = true;
                            
                            loadUserData();
                            updateUIForLoggedInUser();
                            
                            return true;
                        } else {
                            localStorage.removeItem('tafsirHubPermanentLogin');
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading login:', error);
                localStorage.removeItem('tafsirHubPermanentLogin');
            }
            return false;
        }

        // Update UI for logged-in user
        function updateUIForLoggedInUser() {
            const loginBtn = document.querySelector('button[onclick="showLoginModal()"]');
            const logoutBtn = document.getElementById('logout-btn');
            const adminPanelBtn = document.getElementById('admin-panel-btn');
            
            if (loginBtn) {
                const nickname = currentUser.nickname || currentUser.name.split(' ')[0];
                const roleIcon = currentUser.role === 'admin' ? 'fas fa-user-shield' : 'fas fa-user';
                const roleText = currentUser.role === 'admin' ? 'Admin' : '';
                loginBtn.innerHTML = `<i class="${roleIcon} mr-2"></i>${nickname} ${roleText}`;
                loginBtn.onclick = null;
                loginBtn.style.display = 'none';
            }
            
            if (logoutBtn) {
                logoutBtn.style.display = '';
            }
            
            if (adminPanelBtn && userRole === 'admin' && currentUser.username === 'Amir') {
                adminPanelBtn.style.display = '';
            }
            
            // Show/hide admin buttons
            const editBtns = document.querySelectorAll('[id*="edit"], [id*="add"]');
            editBtns.forEach(btn => {
                btn.style.display = userRole === 'admin' ? '' : 'none';
            });
            
            loadTasks('semester6');
            loadSchedules('semester6');
            loadAnnouncements('semester6');
            loadPersonalGroups();
        }

        // Get all subjects - FIXED LIST
        function getAllSubjects() {
            return allSubjects;
        }

        // Get all materials - FIXED LIST
        function getAllMaterials() {
            return allMaterials;
        }

        // Get student options
        function getStudentOptions() {
            return studentDatabase.filter(s => s.active).map(s => ({
                username: s.username,
                display: s.nickname || s.name
            })).sort((a, b) => a.display.localeCompare(b.display));
        }

        // Populate members list
        function populateMembersList() {
            const membersList = document.getElementById('members-list');
            const studentNamesList = document.getElementById('student-names-list');
            
            membersList.innerHTML = '';
            studentNamesList.innerHTML = '';
            
            const sortedStudents = [...studentDatabase].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedStudents.forEach((student, index) => {
                const nameHTML = `
                    <div class="flex items-center text-amber-800 py-1 font-semibold">
                        <span class="w-6 text-xs text-amber-700 mr-2">${index + 1}.</span>
                        <span>${student.name}</span>
                        ${adminList.includes(student.username) ? '<i class="fas fa-crown text-yellow-500 ml-2 text-xs" title="Admin"></i>' : ''}
                    </div>
                `;
                studentNamesList.insertAdjacentHTML('beforeend', nameHTML);
            });
            
            sortedStudents.forEach(student => {
                const initials = student.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                const memberHTML = `
                    <div class="p-4 bg-white rounded-xl border-3 border-amber-400 shadow-md hover:shadow-lg transition-shadow">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full flex items-center justify-center shadow-md">
                                <span class="text-white font-bold text-sm">${initials}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-amber-900">${student.name}</h4>
                                <p class="text-xs text-amber-800 font-semibold">NIM: ${student.nim}</p>
                                ${adminList.includes(student.username) ? '<span class="inline-block px-2 py-1 bg-yellow-200 text-yellow-800 text-xs rounded-full font-bold mt-1">Admin</span>' : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                membersList.insertAdjacentHTML('beforeend', memberHTML);
            });
        }

        // Group Materials Management
        function showGroupMaterialModal() {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat mengedit kelompok materi!');
                return;
            }
            
            populateEditGroupMaterialTable();
            document.getElementById('group-material-modal').classList.remove('hidden');
            document.getElementById('group-material-modal').classList.add('flex');
        }

        function closeGroupMaterialModal() {
            document.getElementById('group-material-modal').classList.add('hidden');
            document.getElementById('group-material-modal').classList.remove('flex');
        }

        function loadGroupMaterials() {
            const container = document.getElementById('group-materials-container');
            container.innerHTML = '';
            
            if (groupMaterialsData.length === 0) {
                container.innerHTML = '<p class="text-amber-700 text-center py-4 font-semibold">Belum ada kelompok. Admin akan mengisi segera.</p>';
                return;
            }
            
            const groupedBySubject = {};
            groupMaterialsData.forEach(item => {
                if (!groupedBySubject[item.subject]) {
                    groupedBySubject[item.subject] = [];
                }
                groupedBySubject[item.subject].push(item);
            });
            
            Object.keys(groupedBySubject).forEach((subject, index) => {
                const items = groupedBySubject[subject];
                
                const sectionHTML = `
                    <div class="border-4 border-amber-500 rounded-xl overflow-hidden shadow-md bg-white">
                        <div class="bg-amber-200 p-4 cursor-pointer hover:bg-amber-300 transition-colors" onclick="toggleSubjectDropdown('subject-${index}')">
                            <div class="flex items-center justify-between">
                                <h4 class="text-lg font-bold text-amber-900">
                                    ${subject}
                                    <span class="ml-3 text-sm font-normal text-amber-800">(${items.length} kelompok)</span>
                                </h4>
                                <i class="fas fa-chevron-down text-amber-900 transition-transform duration-200" id="icon-subject-${index}"></i>
                            </div>
                        </div>
                        <div class="hidden p-4 pt-0" id="subject-${index}">
                            <div class="space-y-3">
                                ${items.map(item => {
                                    const statusColor = item.status === 'Selesai' ? 'bg-green-200 text-green-800' : 'bg-yellow-200 text-yellow-800';
                                    return `
                                        <div class="flex items-start justify-between p-3 bg-amber-50 rounded-lg border-2 border-amber-300">
                                            <div class="flex-1">
                                                <div class="flex items-center mb-2">
                                                    <span class="bg-amber-700 text-white text-xs font-bold px-3 py-1 rounded-full mr-3">Kelompok ${item.number}</span>
                                                    <span class="px-3 py-1 ${statusColor} text-xs rounded-full font-bold">${item.status}</span>
                                                </div>
                                                <div class="mb-2">
                                                    <span class="font-bold text-amber-900">Anggota:</span>
                                                    <span class="text-amber-800 ml-1 font-semibold">${item.members.join(', ')}</span>
                                                </div>
                                                <div>
                                                    <span class="font-bold text-amber-900">Materi:</span>
                                                    <span class="text-amber-800 ml-1 font-semibold">${item.material}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', sectionHTML);
            });
        }

        function toggleSubjectDropdown(subjectId) {
            const content = document.getElementById(subjectId);
            const icon = document.getElementById(`icon-${subjectId}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleStudentDropdown() {
            const content = document.getElementById('student-names-dropdown');
            const icon = document.getElementById('student-dropdown-icon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function populateEditGroupMaterialTable() {
            const tbody = document.getElementById('edit-group-material-tbody');
            tbody.innerHTML = '';
            
            const subjects = getAllSubjects();
            const materials = getAllMaterials();
            const students = getStudentOptions();
            
            groupMaterialsData.forEach((item, index) => {
                const subjectOptions = subjects.map(s => 
                    `<option value="${s}" ${item.subject === s ? 'selected' : ''}>${s}</option>`
                ).join('');
                
                const materialOptions = materials.map(m => 
                    `<option value="${m}" ${item.material === m ? 'selected' : ''}>${m}</option>`
                ).join('');
                
                const memberOptions = students.map(s => 
                    `<option value="${s.display}" ${item.members.includes(s.display) ? 'selected' : ''}>${s.display}</option>`
                ).join('');
                
                const row = `
                    <tr class="border-b-2 border-amber-200 hover:bg-amber-50 transition-colors">
                        <td class="px-4 py-3">
                            <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="subject" data-index="${index}">
                                <option value="">-- Pilih Mata Kuliah --</option>
                                ${subjectOptions}
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <input type="number" value="${item.number}" min="1" class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="number" data-index="${index}">
                        </td>
                        <td class="px-4 py-3">
                            <select multiple class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="members" data-index="${index}" style="height: 100px;">
                                ${memberOptions}
                            </select>
                            <p class="text-xs text-amber-700 mt-1 font-semibold">Tahan Ctrl untuk memilih</p>
                        </td>
                        <td class="px-4 py-3">
                            <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="material" data-index="${index}">
                                <option value="">-- Pilih Materi --</option>
                                ${materialOptions}
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="status" data-index="${index}">
                                <option value="Belum Selesai" ${item.status === 'Belum Selesai' ? 'selected' : ''}>Belum Selesai</option>
                                <option value="Selesai" ${item.status === 'Selesai' ? 'selected' : ''}>Selesai</option>
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="removeGroupMaterialRow(${index})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors font-bold">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        function addGroupMaterialRow() {
            const tbody = document.getElementById('edit-group-material-tbody');
            const newIndex = tbody.children.length;
            
            const subjects = getAllSubjects();
            const materials = getAllMaterials();
            const students = getStudentOptions();
            
            const subjectOptions = subjects.map(s => `<option value="${s}">${s}</option>`).join('');
            const materialOptions = materials.map(m => `<option value="${m}">${m}</option>`).join('');
            const studentOptions = students.map(s => `<option value="${s.display}">${s.display}</option>`).join('');
            
            const row = `
                <tr class="border-b-2 border-amber-200 hover:bg-amber-50 transition-colors">
                    <td class="px-4 py-3">
                        <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="subject" data-index="${newIndex}">
                            <option value="">-- Pilih Mata Kuliah --</option>
                            ${subjectOptions}
                        </select>
                    </td>
                    <td class="px-4 py-3">
                        <input type="number" value="1" min="1" class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="number" data-index="${newIndex}">
                    </td>
                    <td class="px-4 py-3">
                        <select multiple class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="members" data-index="${newIndex}" style="height: 100px;">
                            ${studentOptions}
                        </select>
                        <p class="text-xs text-amber-700 mt-1 font-semibold">Tahan Ctrl untuk memilih</p>
                    </td>
                    <td class="px-4 py-3">
                        <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="material" data-index="${newIndex}">
                            <option value="">-- Pilih Materi --</option>
                            ${materialOptions}
                        </select>
                    </td>
                    <td class="px-4 py-3">
                        <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="status" data-index="${newIndex}">
                            <option value="Belum Selesai">Belum Selesai</option>
                            <option value="Selesai">Selesai</option>
                        </select>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="removeGroupMaterialRow(${newIndex})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors font-bold">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            tbody.insertAdjacentHTML('beforeend', row);
        }

        function removeGroupMaterialRow(index) {
            const tbody = document.getElementById('edit-group-material-tbody');
            const rows = tbody.children;
            
            if (rows[index]) {
                rows[index].remove();
                
                Array.from(rows).forEach((row, newIndex) => {
                    const inputs = row.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        input.setAttribute('data-index', newIndex);
                    });
                    
                    const deleteBtn = row.querySelector('button[onclick*="removeGroupMaterialRow"]');
                    if (deleteBtn) {
                        deleteBtn.setAttribute('onclick', `removeGroupMaterialRow(${newIndex})`);
                    }
                });
            }
        }

        function saveGroupMaterialTable() {
            const tbody = document.getElementById('edit-group-material-tbody');
            const rows = tbody.children;
            const newData = [];
            
            Array.from(rows).forEach(row => {
                const inputs = row.querySelectorAll('input, select');
                const item = {};
                
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    
                    if (field === 'number') {
                        item[field] = parseInt(input.value) || 1;
                    } else if (field === 'members') {
                        const selected = Array.from(input.options)
                            .filter(option => option.selected)
                            .map(option => option.value);
                        item[field] = selected;
                    } else {
                        item[field] = input.value.trim();
                    }
                });
                
                if (item.subject && item.members && item.members.length > 0 && item.material) {
                    newData.push(item);
                }
            });
            
            groupMaterialsData = newData;
            persistentData.global.groupMaterials = newData;
            
            saveDataToStorage();
            loadGroupMaterials();
            
            showSuccessMessage(`${newData.length} kelompok berhasil disimpan!`);
            closeGroupMaterialModal();
        }

        // Schedule Management
        function showScheduleTableModal() {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat mengedit jadwal!');
                return;
            }
            
            populateEditScheduleTable();
            document.getElementById('schedule-table-modal').classList.remove('hidden');
            document.getElementById('schedule-table-modal').classList.add('flex');
        }

        function closeScheduleTableModal() {
            document.getElementById('schedule-table-modal').classList.add('hidden');
            document.getElementById('schedule-table-modal').classList.remove('flex');
        }

        function populateEditScheduleTable() {
            const tbody = document.getElementById('edit-schedule-tbody');
            tbody.innerHTML = '';
            
            const subjects = getAllSubjects();
            const students = getStudentOptions();
            
            scheduleData.forEach((item, index) => {
                const subjectOptions = subjects.map(s => 
                    `<option value="${s}" ${item.subject === s ? 'selected' : ''}>${s}</option>`
                ).join('');
                
                const picArray = Array.isArray(item.pic) ? item.pic : (typeof item.pic === 'string' ? item.pic.split(',').map(p => p.trim()) : []);
                const studentOptions = students.map(s => 
                    `<option value="${s.display}" ${picArray.includes(s.display) ? 'selected' : ''}>${s.display}</option>`
                ).join('');
                
                const row = `
                    <tr class="border-b-2 border-amber-200 hover:bg-amber-50 transition-colors">
                        <td class="px-4 py-3">
                            <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="day" data-index="${index}">
                                <option value="">-- Pilih Hari --</option>
                                <option value="Senin" ${item.day === 'Senin' ? 'selected' : ''}>Senin</option>
                                <option value="Selasa" ${item.day === 'Selasa' ? 'selected' : ''}>Selasa</option>
                                <option value="Rabu" ${item.day === 'Rabu' ? 'selected' : ''}>Rabu</option>
                                <option value="Kamis" ${item.day === 'Kamis' ? 'selected' : ''}>Kamis</option>
                                <option value="Jumat" ${item.day === 'Jumat' ? 'selected' : ''}>Jumat</option>
                                <option value="Sabtu" ${item.day === 'Sabtu' ? 'selected' : ''}>Sabtu</option>
                                <option value="Minggu" ${item.day === 'Minggu' ? 'selected' : ''}>Minggu</option>
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <input type="text" value="${item.time}" placeholder="08.00â€“09.40" class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="time" data-index="${index}">
                        </td>
                        <td class="px-4 py-3">
                            <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="subject" data-index="${index}">
                                <option value="">-- Pilih Mata Kuliah --</option>
                                ${subjectOptions}
                            </select>
                        </td>
                        <td class="px-4 py-3">
                            <select multiple class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="pic" data-index="${index}" style="height: 100px;">
                                ${studentOptions}
                            </select>
                            <p class="text-xs text-amber-700 mt-1 font-semibold">Max 2 orang (Tahan Ctrl)</p>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="removeScheduleRow(${index})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors font-bold">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        function addScheduleRow() {
            const tbody = document.getElementById('edit-schedule-tbody');
            const newIndex = tbody.children.length;
            
            const subjects = getAllSubjects();
            const students = getStudentOptions();
            
            const subjectOptions = subjects.map(s => `<option value="${s}">${s}</option>`).join('');
            const studentOptions = students.map(s => `<option value="${s.display}">${s.display}</option>`).join('');
            
            const row = `
                <tr class="border-b-2 border-amber-200 hover:bg-amber-50 transition-colors">
                    <td class="px-4 py-3">
                        <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="day" data-index="${newIndex}">
                            <option value="">-- Pilih Hari --</option>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                            <option value="Sabtu">Sabtu</option>
                            <option value="Minggu">Minggu</option>
                        </select>
                    </td>
                    <td class="px-4 py-3">
                        <input type="text" placeholder="08.00â€“09.40" class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="time" data-index="${newIndex}">
                    </td>
                    <td class="px-4 py-3">
                        <select class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="subject" data-index="${newIndex}">
                            <option value="">-- Pilih Mata Kuliah --</option>
                            ${subjectOptions}
                        </select>
                    </td>
                    <td class="px-4 py-3">
                        <select multiple class="w-full px-2 py-2 border-2 border-amber-400 rounded-lg font-semibold" data-field="pic" data-index="${newIndex}" style="height: 100px;">
                            ${studentOptions}
                        </select>
                        <p class="text-xs text-amber-700 mt-1 font-semibold">Max 2 orang (Tahan Ctrl)</p>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="removeScheduleRow(${newIndex})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm transition-colors font-bold">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            tbody.insertAdjacentHTML('beforeend', row);
        }

        function removeScheduleRow(index) {
            const tbody = document.getElementById('edit-schedule-tbody');
            const rows = tbody.children;
            
            if (rows[index]) {
                rows[index].remove();
                
                Array.from(rows).forEach((row, newIndex) => {
                    const inputs = row.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        input.setAttribute('data-index', newIndex);
                    });
                    
                    const deleteBtn = row.querySelector('button[onclick*="removeScheduleRow"]');
                    if (deleteBtn) {
                        deleteBtn.setAttribute('onclick', `removeScheduleRow(${newIndex})`);
                    }
                });
            }
        }

        function saveScheduleTable() {
            const tbody = document.getElementById('edit-schedule-tbody');
            const rows = tbody.children;
            const newData = [];
            
            Array.from(rows).forEach(row => {
                const inputs = row.querySelectorAll('input, select');
                const item = {};
                
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    
                    if (field === 'pic') {
                        const selected = Array.from(input.options)
                            .filter(option => option.selected)
                            .map(option => option.value);
                        
                        if (selected.length > 2) {
                            showErrorMessage('Penanggung jawab maksimal 2 orang!');
                            return;
                        }
                        item[field] = selected;
                    } else {
                        item[field] = input.value.trim();
                    }
                });
                
                if (item.day && item.time && item.subject && item.pic && item.pic.length > 0) {
                    newData.push(item);
                }
            });
            
            scheduleData = newData;
            persistentData.global.scheduleData = newData;
            
            saveDataToStorage();
            updateScheduleTables();
            
            showSuccessMessage(`${newData.length} jadwal berhasil disimpan!`);
            closeScheduleTableModal();
        }

        function updateScheduleTables() {
            const tables = document.querySelectorAll('#schedule-table tbody, #semester6-schedule-tbody');
            
            tables.forEach(tbody => {
                tbody.innerHTML = '';
                
                if (scheduleData.length === 0) {
                    return;
                }
                
                const groupedByDay = {};
                scheduleData.forEach(item => {
                    if (!groupedByDay[item.day]) {
                        groupedByDay[item.day] = [];
                    }
                    groupedByDay[item.day].push(item);
                });
                
                Object.keys(groupedByDay).forEach(day => {
                    const dayItems = groupedByDay[day];
                    
                    dayItems.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-amber-50 transition-colors border-b-2 border-amber-200';
                        
                        if (index === 0) {
                            const dayCell = document.createElement('td');
                            dayCell.className = 'px-4 py-3 text-amber-800 font-bold bg-amber-100';
                            dayCell.textContent = day;
                            if (dayItems.length > 1) {
                                dayCell.rowSpan = dayItems.length;
                            }
                            row.appendChild(dayCell);
                        }
                        
                        const timeCell = document.createElement('td');
                        timeCell.className = 'px-4 py-3 text-amber-800 font-semibold';
                        timeCell.textContent = item.time;
                        row.appendChild(timeCell);
                        
                        const subjectCell = document.createElement('td');
                        subjectCell.className = 'px-4 py-3 text-amber-900 font-bold';
                        subjectCell.textContent = item.subject;
                        row.appendChild(subjectCell);
                        
                        const picCell = document.createElement('td');
                        picCell.className = 'px-4 py-3 text-amber-800 font-semibold';
                        const picArray = Array.isArray(item.pic) ? item.pic : [item.pic];
                        picCell.textContent = picArray.join(', ');
                        row.appendChild(picCell);
                        
                        tbody.appendChild(row);
                    });
                });
            });
        }

        function loadSchedules(semester) {
            // Helper function - minimal implementation
        }

        // Tasks Management
        function showTaskModal(semester) {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat menambah tugas!');
                return;
            }
            currentSemester = semester;
            document.getElementById('task-modal').classList.remove('hidden');
            document.getElementById('task-modal').classList.add('flex');
        }

        function closeTaskModal() {
            document.getElementById('task-modal').classList.add('hidden');
            document.getElementById('task-modal').classList.remove('flex');
            document.getElementById('task-form').reset();
        }

        function handleAddTask(event) {
            event.preventDefault();
            
            const task = {
                id: Date.now(),
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                deadline: document.getElementById('task-deadline').value,
                submissionLink: document.getElementById('task-submission-link').value,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString(),
                completed: false
            };

            if (!persistentData.global.tasks[currentSemester]) {
                persistentData.global.tasks[currentSemester] = [];
            }
            
            persistentData.global.tasks[currentSemester].push(task);
            saveDataToStorage();
            loadTasks(currentSemester);
            updateAllStats();
            
            showSuccessMessage('Tugas berhasil ditambahkan!');
            closeTaskModal();
        }

        function loadTasks(semester) {
            const container = document.getElementById(`${semester}-tasks`);
            const tugasPageContainer = document.getElementById('tugas-page-tasks');
            
            const tasks = persistentData.global.tasks[semester] || [];
            
            const taskHTML = generateTasksHTML(tasks, semester);
            
            if (container) {
                container.innerHTML = taskHTML || '<p class="text-amber-700 text-center py-4 font-semibold">Belum ada tugas</p>';
            }
            
            if (tugasPageContainer) {
                tugasPageContainer.innerHTML = taskHTML || '<p class="text-amber-700 text-center py-4 font-semibold">Belum ada tugas</p>';
            }
        }

        function generateTasksHTML(tasks, semester) {
            if (tasks.length === 0) return '';
            
            return tasks.map(task => {
                const deadline = new Date(task.deadline);
                const isOverdue = deadline < new Date() && !task.completed;
                
                return `
                    <div class="p-4 bg-white rounded-xl border-3 border-blue-400 shadow-md ${task.completed ? 'opacity-60' : 'hover:shadow-lg'} transition-shadow">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-amber-900 ${task.completed ? 'line-through' : ''}">${task.title}</h4>
                            ${task.submissionLink ? `
                                <a href="${task.submissionLink}" target="_blank" rel="noopener noreferrer" class="px-3 py-1 bg-blue-500 text-white text-xs rounded-full hover:bg-blue-600 font-bold">
                                    <i class="fas fa-external-link-alt mr-1"></i>Kumpul
                                </a>
                            ` : ''}
                        </div>
                        ${task.description ? `<p class="text-sm text-amber-800 mb-2 font-semibold">${task.description}</p>` : ''}
                        <div class="flex justify-between items-center text-xs text-amber-700 font-semibold mb-2">
                            <span class="${isOverdue ? 'text-red-600 font-bold' : ''}">
                                Deadline: ${deadline.toLocaleDateString('id-ID')} ${deadline.toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}
                            </span>
                            <div class="flex space-x-2">
                                <button onclick="toggleTaskComplete(${task.id}, '${semester}')" class="text-blue-600 hover:text-blue-800 font-bold">
                                    <i class="fas ${task.completed ? 'fa-undo' : 'fa-check'}"></i>
                                </button>
                                ${(isLoggedIn && userRole === 'admin') ? `
                                    <button onclick="deleteTask(${task.id}, '${semester}')" class="text-red-600 hover:text-red-800 font-bold">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        <div class="text-xs text-amber-700 font-semibold">Dibuat oleh: ${task.createdBy}</div>
                    </div>
                `;
            }).join('');
        }

        function toggleTaskComplete(taskId, semester) {
            if (!isLoggedIn) {
                showErrorMessage('Silakan login terlebih dahulu!');
                return;
            }
            
            const tasks = persistentData.global.tasks[semester] || [];
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.completed = !task.completed;
                saveDataToStorage();
                loadTasks(semester);
                updateAllStats();
                showSuccessMessage(`Tugas ${task.completed ? 'selesai' : 'belum selesai'}!`);
            }
        }

        function deleteTask(taskId, semester) {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat menghapus tugas!');
                return;
            }
            
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4 border-4 border-red-400">
                    <h3 class="text-lg font-bold text-amber-900 mb-4">Konfirmasi Hapus</h3>
                    <p class="text-amber-800 mb-6 font-semibold">Apakah Anda yakin ingin menghapus tugas ini?</p>
                    <div class="flex space-x-3">
                        <button onclick="confirmDeleteTask(true, ${taskId}, '${semester}', this)" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-bold transition-colors">Ya, Hapus</button>
                        <button onclick="confirmDeleteTask(false, ${taskId}, '${semester}', this)" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg font-bold transition-colors">Batal</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
        }

        function confirmDeleteTask(confirmed, taskId, semester, buttonElement) {
            const confirmDiv = buttonElement.closest('.fixed');
            document.body.removeChild(confirmDiv);
            
            if (confirmed) {
                const tasks = persistentData.global.tasks[semester] || [];
                const index = tasks.findIndex(t => t.id === taskId);
                
                if (index !== -1) {
                    tasks.splice(index, 1);
                    saveDataToStorage();
                    loadTasks(semester);
                    updateAllStats();
                    showSuccessMessage('Tugas berhasil dihapus!');
                }
            }
        }

        // Announcements Management
        function showAnnouncementModal(semester) {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat menambah pengumuman!');
                return;
            }
            currentSemester = semester;
            document.getElementById('announcement-modal').classList.remove('hidden');
            document.getElementById('announcement-modal').classList.add('flex');
        }

        function closeAnnouncementModal() {
            document.getElementById('announcement-modal').classList.add('hidden');
            document.getElementById('announcement-modal').classList.remove('flex');
            document.getElementById('announcement-form').reset();
        }

        function handleAddAnnouncement(event) {
            event.preventDefault();
            
            const announcement = {
                id: Date.now(),
                title: document.getElementById('announcement-title').value,
                content: document.getElementById('announcement-content').value,
                type: document.getElementById('announcement-type').value,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };

            if (!persistentData.global.announcements[currentSemester]) {
                persistentData.global.announcements[currentSemester] = [];
            }
            
            persistentData.global.announcements[currentSemester].push(announcement);
            saveDataToStorage();
            loadAnnouncements(currentSemester);
            loadLatestAnnouncements();
            
            showSuccessMessage('Pengumuman berhasil ditambahkan!');
            closeAnnouncementModal();
        }

        function loadAnnouncements(semester) {
            const container = document.getElementById(`${semester}-announcements`);
            if (!container) return;
            
            container.innerHTML = '';
            
            const announcements = persistentData.global.announcements[semester] || [];
            
            if (announcements.length === 0) {
                container.innerHTML = '<p class="text-amber-700 text-center py-4 font-semibold">Belum ada pengumuman</p>';
                return;
            }
            
            announcements.forEach(announcement => {
                const typeColor = announcement.type === 'urgent' ? 'bg-red-300 text-red-900 border-red-500' : 
                                announcement.type === 'important' ? 'bg-yellow-300 text-yellow-900 border-yellow-500' : 
                                'bg-blue-300 text-blue-900 border-blue-500';
                
                const typeIcon = announcement.type === 'urgent' ? 'fa-exclamation-triangle' : 
                               announcement.type === 'important' ? 'fa-exclamation-circle' : 
                               'fa-info-circle';
                
                const createdDate = new Date(announcement.createdAt);
                
                const announcementHTML = `
                    <div class="p-4 ${typeColor} rounded-xl border-3 shadow-md">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold flex items-center">
                                <i class="fas ${typeIcon} mr-2"></i>
                                ${announcement.title}
                            </h4>
                            ${(isLoggedIn && userRole === 'admin') ? `
                                <button onclick="deleteAnnouncement(${announcement.id}, '${semester}')" class="text-red-700 hover:text-red-900 font-bold">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            ` : ''}
                        </div>
                        <p class="mb-2 font-semibold">${announcement.content}</p>
                        <div class="text-sm opacity-90 font-semibold">
                            Oleh: ${announcement.createdBy} â€¢ ${createdDate.toLocaleDateString('id-ID')} ${createdDate.toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', announcementHTML);
            });
        }

        function loadLatestAnnouncements() {
            const container = document.getElementById('latest-announcements');
            if (!container) return;
            
            let allAnnouncements = [];
            Object.keys(persistentData.global.announcements).forEach(semester => {
                allAnnouncements = allAnnouncements.concat(persistentData.global.announcements[semester] || []);
            });
            
            allAnnouncements.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            const latestAnnouncements = allAnnouncements.slice(0, 3);
            
            container.innerHTML = '';
            
            if (latestAnnouncements.length === 0) {
                container.innerHTML = '<p class="text-amber-200 text-center py-4 font-semibold">Belum ada pengumuman</p>';
                return;
            }
            
            latestAnnouncements.forEach(announcement => {
                const typeColor = announcement.type === 'urgent' ? 'bg-red-600/80 border-red-400' : 
                                announcement.type === 'important' ? 'bg-yellow-600/80 border-yellow-400' : 
                                'bg-blue-600/80 border-blue-400';
                
                const typeIcon = announcement.type === 'urgent' ? 'fa-exclamation-triangle' : 
                               announcement.type === 'important' ? 'fa-exclamation-circle' : 
                               'fa-info-circle';
                
                const createdDate = new Date(announcement.createdAt);
                
                const announcementHTML = `
                    <div class="p-4 ${typeColor} rounded-xl border-3 shadow-md text-white">
                        <h4 class="font-bold flex items-center mb-1">
                            <i class="fas ${typeIcon} mr-2"></i>
                            ${announcement.title}
                        </h4>
                        <p class="text-sm mb-2 font-semibold">${announcement.content}</p>
                        <div class="text-xs opacity-90 font-semibold">
                            ${createdDate.toLocaleDateString('id-ID')} â€¢ ${announcement.createdBy}
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', announcementHTML);
            });
        }

        function deleteAnnouncement(announcementId, semester) {
            if (!isLoggedIn || userRole !== 'admin') {
                showErrorMessage('Hanya admin yang dapat menghapus pengumuman!');
                return;
            }
            
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4 border-4 border-red-400">
                    <h3 class="text-lg font-bold text-amber-900 mb-4">Konfirmasi Hapus</h3>
                    <p class="text-amber-800 mb-6 font-semibold">Apakah Anda yakin ingin menghapus pengumuman ini?</p>
                    <div class="flex space-x-3">
                        <button onclick="confirmDeleteAnnouncement(true, ${announcementId}, '${semester}', this)" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-bold transition-colors">Ya, Hapus</button>
                        <button onclick="confirmDeleteAnnouncement(false, ${announcementId}, '${semester}', this)" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg font-bold transition-colors">Batal</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
        }

        function confirmDeleteAnnouncement(confirmed, announcementId, semester, buttonElement) {
            const confirmDiv = buttonElement.closest('.fixed');
            document.body.removeChild(confirmDiv);
            
            if (confirmed) {
                const announcements = persistentData.global.announcements[semester] || [];
                const index = announcements.findIndex(a => a.id === announcementId);
                
                if (index !== -1) {
                    announcements.splice(index, 1);
                    saveDataToStorage();
                    loadAnnouncements(semester);
                    loadLatestAnnouncements();
                    showSuccessMessage('Pengumuman berhasil dihapus!');
                }
            }
        }

        // Personal Groups
        function loadPersonalGroups() {
            const container = document.getElementById('personal-groups');
            container.innerHTML = '';
            
            if (!isLoggedIn) {
                container.innerHTML = '<p class="text-amber-700 text-center py-4 font-semibold">Silakan login untuk melihat kelompok</p>';
                return;
            }
            
            if (groupMaterialsData.length === 0) {
                container.innerHTML = '<p class="text-amber-700 text-center py-4 font-semibold">Belum ada kelompok</p>';
                return;
            }
            
            const userMaterialGroups = groupMaterialsData.filter(item => {
                if (!item.members || item.members.length === 0) return false;
                const memberArray = Array.isArray(item.members) ? item.members : [item.members];
                return memberArray.some(memberName => {
                    const student = studentDatabase.find(s => 
                        s.name.toLowerCase().includes(memberName.toLowerCase()) ||
                        s.nickname.toLowerCase() === memberName.toLowerCase()
                    );
                    return student && student.username === currentUser.username;
                });
            });
            
            if (userMaterialGroups.length === 0) {
                container.innerHTML = '<p class="text-amber-700 text-center py-4 font-semibold">Anda belum termasuk dalam kelompok manapun</p>';
                return;
            }
            
            userMaterialGroups.forEach((group, index) => {
                const membersArray = Array.isArray(group.members) ? group.members : [group.members];
                const membersHTML = membersArray.map(member => 
                    `<span class="px-3 py-1 bg-blue-300 text-blue-900 text-sm rounded-full font-bold">${member}</span>`
                ).join('');
                
                const statusColor = group.status === 'Selesai' ? 'bg-green-200 text-green-900' : 'bg-yellow-200 text-yellow-900';
                
                const groupHTML = `
                    <div class="p-4 border-4 border-green-500 bg-green-100 rounded-xl shadow-md">
                        <h4 class="font-bold text-amber-900 mb-2 flex items-center text-lg">
                            <i class="fas fa-graduation-cap text-green-700 mr-2"></i>
                            ${group.subject} (Kelompok ${group.number})
                        </h4>
                        <div class="flex flex-wrap gap-2 mb-3">
                            ${membersHTML}
                        </div>
                        <p class="text-sm text-amber-800 mb-2 font-bold"><strong>Materi:</strong> ${group.material}</p>
                        <div class="flex items-center justify-between">
                            <span class="inline-block px-3 py-1 ${statusColor} text-xs rounded-full font-bold">
                                ${group.status}
                            </span>
                            <span class="text-xs bg-green-400 text-green-900 px-3 py-1 rounded-full font-bold">Kelompok Resmi</span>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHTML);
            });
        }

        // Admin Panel
        function showAdminPanel() {
            if (!isLoggedIn || currentUser.username !== 'Amir') {
                showErrorMessage('Hanya Amir (Admin Utama) yang dapat mengelola admin!');
                return;
            }
            
            populateAdminList();
            populateAdminSelect();
            document.getElementById('admin-panel-modal').classList.remove('hidden');
            document.getElementById('admin-panel-modal').classList.add('flex');
        }

        function closeAdminPanel() {
            document.getElementById('admin-panel-modal').classList.add('hidden');
            document.getElementById('admin-panel-modal').classList.remove('flex');
        }

        function populateAdminList() {
            const listDiv = document.getElementById('admin-list-display');
            listDiv.innerHTML = '';
            
            adminList.forEach(adminUsername => {
                const student = studentDatabase.find(s => s.username === adminUsername);
                if (student) {
                    const adminHTML = `
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg border-2 border-amber-400 shadow-sm">
                            <div class="flex items-center">
                                <i class="fas fa-crown text-yellow-500 mr-2 text-lg"></i>
                                <span class="font-bold text-amber-900">${student.name}</span>
                                ${adminUsername === 'Amir' ? '<span class="ml-2 text-xs bg-red-300 text-red-900 px-3 py-1 rounded-full font-bold">Admin Utama</span>' : ''}
                            </div>
                            ${adminUsername !== 'Amir' ? `
                                <button onclick="removeAdmin('${adminUsername}')" class="text-red-600 hover:text-red-800 text-lg font-bold">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    `;
                    listDiv.insertAdjacentHTML('beforeend', adminHTML);
                }
            });
        }

        function populateAdminSelect() {
            const selectDiv = document.getElementById('admin-select');
            selectDiv.innerHTML = '<option value="">-- Pilih Mahasiswa --</option>';
            
            studentDatabase.filter(s => s.active && !adminList.includes(s.username)).forEach(student => {
                const option = document.createElement('option');
                option.value = student.username;
                option.textContent = `${student.name} (${student.nickname})`;
                selectDiv.appendChild(option);
            });
        }

        function addAdminToList() {
            const selectDiv = document.getElementById('admin-select');
            const selectedUsername = selectDiv.value;
            
            if (!selectedUsername) {
                showErrorMessage('Silakan pilih mahasiswa terlebih dahulu!');
                return;
            }
            
            if (!adminList.includes(selectedUsername)) {
                adminList.push(selectedUsername);
                saveDataToStorage();
                populateAdminList();
                populateAdminSelect();
                populateMembersList();
                showSuccessMessage('Admin pembantu berhasil ditambahkan!');
            }
        }

        function removeAdmin(username) {
            if (username === 'Amir') {
                showErrorMessage('Admin Utama tidak dapat dihapus!');
                return;
            }
            
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4 border-4 border-red-400">
                    <h3 class="text-lg font-bold text-amber-900 mb-4">Konfirmasi Hapus Admin</h3>
                    <p class="text-amber-800 mb-6 font-semibold">Apakah Anda yakin ingin menghapus admin ini?</p>
                    <div class="flex space-x-3">
                        <button onclick="confirmRemoveAdmin(true, '${username}', this)" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-bold transition-colors">Ya, Hapus</button>
                        <button onclick="confirmRemoveAdmin(false, '${username}', this)" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded-lg font-bold transition-colors">Batal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        function confirmRemoveAdmin(confirmed, username, buttonElement) {
            const confirmDiv = buttonElement.closest('.fixed');
            document.body.removeChild(confirmDiv);
            
            if (confirmed) {
                const index = adminList.indexOf(username);
                if (index !== -1) {
                    adminList.splice(index, 1);
                    saveDataToStorage();
                    populateAdminList();
                    populateAdminSelect();
                    populateMembersList();
                    showSuccessMessage('Admin berhasil dihapus!');
                }
            }
        }

        // Stats
        function updateAllStats() {
            document.getElementById('total-members').textContent = studentDatabase.filter(s => s.active).length;
            document.getElementById('total-students-display').textContent = studentDatabase.filter(s => s.active).length;
            
            let totalTasks = 0;
            Object.keys(persistentData.global.tasks).forEach(semester => {
                totalTasks += (persistentData.global.tasks[semester] || []).length;
            });
            document.getElementById('total-tasks').textContent = totalTasks;
        }

        // Utility functions
        function showSuccessMessage(message) {
            showMessage(message, 'success');
        }

        function showErrorMessage(message) {
            showMessage(message, 'error');
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            
            messageDiv.className = `fixed top-20 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full font-bold`;
            messageDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                messageDiv.classList.add('translate-x-full');
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        document.body.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize app
        function initializeApp() {
            initializeDataStorage();
            setupDataChangeListener();
            
            const loginRestored = loadPermanentLogin();
            
            populateMembersList();
            loadGroupMaterials();
            updateScheduleTables();
            loadTasks('semester6');
            loadAnnouncements('semester6');
            loadLatestAnnouncements();
            
            if (loginRestored) {
                loadPersonalGroups();
            }
            
            updateAllStats();
            
            console.log('TafsirHub initialized successfully');
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cc81fa650636d1a',t:'MTc3MDg1Nzc2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<!-- FIREBASE START -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAkXfI_m3m8RLj3lz9cxNCcVg24Jqm-W_Y",
  authDomain: "iat6c-web.firebaseapp.com",
  projectId: "iat6c-web",
  storageBucket: "iat6c-web.firebasestorage.app",
  messagingSenderId: "978152586978",
  appId: "1:978152586978:web:ed5a3585bf18b00ef0a8bb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.addDoc = addDoc;
window.collection = collection;
window.getDocs = getDocs;

</script>
<!-- FIREBASE END -->
</body>
</html>